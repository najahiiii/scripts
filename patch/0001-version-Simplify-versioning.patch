From a18d9903b24dabfa1a726015d3ef2d0860d2583f Mon Sep 17 00:00:00 2001
From: Ahmad Thoriq Najahi <najahi@zephyrus.id>
Date: Fri, 29 Jan 2021 00:41:37 +0700
Subject: [PATCH] version: Simplify versioning

* Hardcode versioning
* Remove git suffix

Signed-off-by: Ahmad Thoriq Najahi <najahi@zephyrus.id>
---
 clang/lib/Basic/Version.cpp | 10 ++--------
 libcxx/CMakeLists.txt       |  2 +-
 libunwind/CMakeLists.txt    |  2 +-
 lld/Common/Version.cpp      |  8 +-------
 llvm/CMakeLists.txt         |  2 +-
 5 files changed, 6 insertions(+), 18 deletions(-)

diff --git a/clang/lib/Basic/Version.cpp b/clang/lib/Basic/Version.cpp
index af3118b0f6da..286e6df0dc9a 100644
--- a/clang/lib/Basic/Version.cpp
+++ b/clang/lib/Basic/Version.cpp
@@ -23,10 +23,10 @@ namespace clang {
 
 std::string getClangRepositoryPath() {
 #if defined(CLANG_REPOSITORY_STRING)
-  return CLANG_REPOSITORY_STRING;
+  return "";
 #else
 #ifdef CLANG_REPOSITORY
-  return CLANG_REPOSITORY;
+  return "";
 #else
   return "";
 #endif
@@ -35,24 +35,18 @@ std::string getClangRepositoryPath() {
 
 std::string getLLVMRepositoryPath() {
 #ifdef LLVM_REPOSITORY
-  return LLVM_REPOSITORY;
-#else
   return "";
 #endif
 }
 
 std::string getClangRevision() {
 #ifdef CLANG_REVISION
-  return CLANG_REVISION;
-#else
   return "";
 #endif
 }
 
 std::string getLLVMRevision() {
 #ifdef LLVM_REVISION
-  return LLVM_REVISION;
-#else
   return "";
 #endif
 }
diff --git a/libcxx/CMakeLists.txt b/libcxx/CMakeLists.txt
index 93827cf57b10..2d679e9ad3b8 100644
--- a/libcxx/CMakeLists.txt
+++ b/libcxx/CMakeLists.txt
@@ -27,7 +27,7 @@ if (CMAKE_SOURCE_DIR STREQUAL CMAKE_CURRENT_SOURCE_DIR OR LIBCXX_STANDALONE_BUIL
   project(libcxx CXX C)
 
   set(PACKAGE_NAME libcxx)
-  set(PACKAGE_VERSION 14.0.0git)
+  set(PACKAGE_VERSION 14.0.0)
   set(PACKAGE_STRING "${PACKAGE_NAME} ${PACKAGE_VERSION}")
   set(PACKAGE_BUGREPORT "llvm-bugs@lists.llvm.org")
 
diff --git a/libunwind/CMakeLists.txt b/libunwind/CMakeLists.txt
index a73f5b0c7bdf..74f60a7553c6 100644
--- a/libunwind/CMakeLists.txt
+++ b/libunwind/CMakeLists.txt
@@ -24,7 +24,7 @@ if (CMAKE_SOURCE_DIR STREQUAL CMAKE_CURRENT_SOURCE_DIR OR LIBUNWIND_STANDALONE_B
   project(libunwind LANGUAGES C CXX ASM)
 
   set(PACKAGE_NAME libunwind)
-  set(PACKAGE_VERSION 14.0.0git)
+  set(PACKAGE_VERSION 14.0.0)
   set(PACKAGE_STRING "${PACKAGE_NAME} ${PACKAGE_VERSION}")
   set(PACKAGE_BUGREPORT "llvm-bugs@lists.llvm.org")
 
diff --git a/lld/Common/Version.cpp b/lld/Common/Version.cpp
index ec6eda6a6748..2b31bf70be8c 100644
--- a/lld/Common/Version.cpp
+++ b/lld/Common/Version.cpp
@@ -18,11 +18,5 @@
 // LLD 14.0.0 (https://github.com/llvm/llvm-project.git
 // 2d9759c7902c5cbc9a7e3ab623321d5578d51687)
 std::string lld::getLLDVersion() {
-#ifdef LLD_VENDOR
-#define LLD_VENDOR_DISPLAY LLD_VENDOR " "
-#else
-#define LLD_VENDOR_DISPLAY
-#endif
-  return LLD_VENDOR_DISPLAY "LLD " LLD_VERSION_STRING;
-#undef LLD_VENDOR_DISPLAY
+return "LLD " LLD_VERSION_STRING;
 }
diff --git a/llvm/CMakeLists.txt b/llvm/CMakeLists.txt
index 34392f3308d0..c8103c3548c2 100644
--- a/llvm/CMakeLists.txt
+++ b/llvm/CMakeLists.txt
@@ -20,7 +20,7 @@ if(NOT DEFINED LLVM_VERSION_PATCH)
   set(LLVM_VERSION_PATCH 0)
 endif()
 if(NOT DEFINED LLVM_VERSION_SUFFIX)
-  set(LLVM_VERSION_SUFFIX git)
+  set(LLVM_VERSION_SUFFIX "")
 endif()
 
 if (NOT PACKAGE_VERSION)
-- 
2.17.1

